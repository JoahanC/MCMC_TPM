	SUBROUTINE XY_TO_V(XX,YY,E)
C	convert XX, YY on equal area plane into unit vector
C	XX in 0..2*pi
C	YY in -4/3 to +4/3
	REAL*4 E(3)
	REAL XX,YY
	REAL*8 TWOPI,PI,PIOVER2,PIOVER4
	PARAMETER (TWOPI = 6.28318530717958D0)
	PARAMETER (PI = 3.14159265358979D0)
	PARAMETER (PIOVER2 = 1.5707963267949D0)
	PARAMETER (PIOVER4 = 0.785398163397448D0)
C	check inputs - allow extended range
	IF (ABS(YY).GE.3.) STOP 'YY out of range in XY_TO_V'
	IF (XX.LT.-4. .OR. XX.GT.8.)
	1	STOP 'XX out of range in XY_TO_V'
C	fold extended range into correct range
	Y = YY
	X = XX
	IF (Y.GT.1.3333333) THEN
	  Y = 2.666666667-Y
	  X = X+PI
	ENDIF
	IF (Y.LT.-1.3333333) THEN
	  Y = -2.666666667-Y
	  X = X+PI
	ENDIF
	IF (X.LT.0.) X=X+TWOPI
	IF (X.GT.TWOPI) X=X-TWOPI
	N = X/PIOVER2
	IF (N.GE.4) N=3
	YA = ABS(YY)
	IF (YA.GT.(2./3.)) THEN
	  SINLAT = 2*YA-0.75*YA*YA-1./3.
	  COSLAT = SQRT((1.+SINLAT)/12.)*(4-3.*YA)
	  SINLAT = SIGN(SINLAT,Y)
	  DIV = 2.-1.5*YA
	  IF (DIV.GT.0) THEN
	    ALONG = (X-(N+0.5)*PIOVER2*(1.5*YA-1.))/(2.-1.5*YA)
	  ELSE
	    ALONG = (N+0.5)*PIOVER2
	  ENDIF
	ELSE
	  SINLAT = Y
	  COSLAT = SQRT(1.-SINLAT**2)
	  ALONG = X
	ENDIF
	E(3) = SINLAT
	E(2) = COSLAT*SIN(ALONG)
	E(1) = COSLAT*COS(ALONG)
	RETURN
	END
